  .386
.model flat,STDCALL

        extrn CreateFileA:Proc
        extrn GlobalAlloc:Proc
        extrn GlobalLock:Proc
        extrn ReadFile:Proc
        extrn GetLastError:Proc
        extrn MessageBoxA:Proc
        extrn CloseHandle:Proc
        extrn GlobalUnlock:Proc
        extrn GlobalFree:Proc
        extrn ExitProcess:Proc

.data
    title1		db 'ЛР 3 Джус ПВ',0
    openname	db 'pabloj.txt',250 dup(0)
    hFile		dd 0
    hMemory	dd 0      ; Хендл блоку пам’яті
    pMemory	dd 0      ; Адреса блоку пам’яті
    SizeRead	dd 0
    MEMSIZE	equ 1000000h  ; 16 Mb

.code
Start: push 0
        push 0h          ; файл з довільними атрибутами
        push 4h          ; відкрити існуючий або створити новий
        push 0            ; без атрибутів безпеки
        push 1h          ; дозволено спільний доступ по читанню
        push 80000000h             ; читати файл
        push offset openname	    ; адреса імені файлу
        call CreateFileA
	mov  hFile,eax         ; отримали хендл файлу
	
        push MEMSIZE
        push 2h + 40h       ; GMEM_MOVEABLE + GMEM_ZEROINIT
        call GlobalAlloc
	mov  hMemory,eax             ; отримали хендл блоку пам’яті

        push hMemory
        call GlobalLock                       ; розмістили блок
	mov  pMemory,eax           ; та отримали його адресу

        push 0
        push offset SizeRead ; адреса змінної скільки байтів прочитано
        push MEMSIZE-1     ; скільки байтів можна прочитати
        push pMemory		; адреса початку блоку
        push hFile                                 ; хендл файлу
        call ReadFile		; функція читання файлу

        push 0
        push offset title1
        push pMemory            ; вивід блоку пам’яті на екран
        push 0
        call MessageBoxA

        push hFile
        call CloseHandle           ; закрити файл        push hMemory
        call GlobalUnlock         ; розблокувати блок пам’яті

        push hMemory
        call GlobalFree             ; звільнити блок пам’яті

        push 0
        call ExitProcess             ; повернення у Windows

end Start
